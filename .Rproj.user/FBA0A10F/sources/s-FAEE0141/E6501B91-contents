## Procesamiento de datos Examen - Javier Ortiz ##

## 1. Carga de paquetes: -----------------------------------

pacman::p_load(tidyverse, 
               sjmisc,
               srvyr,
               magrittr,
               sjPlot,
               dplyr,
               car,
               sjlabelled)

## 2. Carga de base de datos: ------------------------------

data <- read_rds(url("https://github.com/learn-R/examen-Javier-Ortiz-It/raw/main/input/data/Latinobarometro_2020.rds"))
                     

## 3. Explorar datos:--------------------------------------                 

view_df(data)


## 4. Seleccion de variables: -----------------------------

# Nivel de coanficanza

#P13ST.G: Confianza en los Partidos Políticos

# Participacion politica deliverativa

#P62ST.B Las elecciones ofrecen a los votantes una real opción de elegir entre partidos y candidatos
#P56N: Mejor forma de actuar para que Ud. y el país avancen más (categorias deliverativas y participativas)

# Paricipacion politica participativa

#P55ST.B: Acción política: Asistir a manifestaciones autorizadas
#P59N.F: Dispuesto a salir a marchar y protestar por: Una sociedad con mas igualdad

# valoracion de la democracia

#P22STM.B No me importaría que un gobierno no democrático llegara al poder si resuelve los problemas
#P20STM.C La democracia permite que se solucionen los problemas que tenemos
#P11STGBS.A Satisfacción con la democracia

# Variables demograficas 

#IDENPA: identificacion del pais
#edad
#sexo

data_proc <- data %>% 
  select(nc_partidos = p13st_g,
         p62st_b,
         p56n,
         p55st_b,
         p59n_f,
         p22stm_b,
         p20stm_c,
         satisfaccion_demo = P11STGBS_A,
         pais = idenpa,
         edad,
         sexo)

# Exploracipn de variables seleccionadas
view_df(data_proc)

frq(data_proc$nc_partidos)
frq(data_proc$p62st_b)
frq(data_proc$p56n)
frq(data_proc$p55st_b)
frq(data_proc$p59n_f)
frq(data_proc$p22stm_b)
frq(data_proc$p20stm_c)
frq(data_proc$satisfaccion_demo)
frq(data_proc$pais)
sjmisc::descr(data_proc$edad)# PROBLEMAS CON LOS DESCRIPTIVOS DE EDAD
frq(data_proc$sexo)


# 5. Transformacion de variables:----------------------

# Confianza en los Partidos politicos
data_proc <- data_proc %>% 
  mutate(nc_partidos = car::recode(.$nc_partidos,
                                   recodes = c("1 = 'Mucha';
                                               2 = 'Algo';
                                               3 = 'Poca';
                                               4 = 'Ninguna';
                                               -1 = 'No sabe';
                                               -2 = 'No contesta';
                                               -3 = 'NA';
                                               -4 = 'NA';
                                               -5 = 'NA'"),
                                   as.factor = T,
                                   levels = c('Ninguna',
                                              'Poca',
                                              'Algo',
                                              'Mucha',
                                              'No sabe',
                                              'No contesta'))) 
# Comprobamos
frq(data_proc$nc_partidos)

# Las elecciones ofrecen a los votantes una real opción de elegir entre partidos y candidatos

data_proc <- data_proc %>% 
  mutate(p62st_b = car::recode(.$p62st_b,
                               recodes = c("1 ='Muy de acuerdo';
                                           2 = 'De acuerdo';
                                           3 = 'En desacuerdo';
                                           4 = 'Muy en desacuerdo';
                                           -1 = 'No sabe';
                                           -2 = 'No contesta';
                                           -3 = 'NA';
                                           -4 = 'NA';
                                           -5 = 'NA'"),
                               as.factor = T,
                               levels = c('Muy en desacuerdo',
                                          'En desacuerdo',
                                          'De acuerdo',
                                          'Muy de acuerdo',
                                          'No sabe',
                                          'No contesta')))

#comrpobamos
frq(data_proc$p62st_b)

#Mejor forma de actuar para que Ud. y el país avancen más

data_proc <- data_proc %>% 
  mutate(p56n = car::recode(.$p56n,
                            recodes = c("1 = 'Hay que votar siempre';
                                        2 = 'Hay que votar pero tambien protestar';
                                        3 = 'Solo hay que protestar, no sirve votar';
                                        4 = 'No hay que hacer nada, ni votar ni protestar';
                                        5 = 'No hay que hacer nada';
                                        -1 = 'NA';
                                        -2 = 'NA';
                                        -3 = 'NA';
                                        -4 = 'NA';
                                        -5 = 'NA'"),
                            as.factor = T,
                            levels = c('Hay que votar siempre',
                                       'Hay que votar pero tambien protestar',
                                       'Solo hay que protestar, no sirve votar',
                                       'No hay que hacer nada, ni votar ni protestar',
                                       'No hay que hacer nada')))

# Comprobemos
frq(data_proc$p56n)

#Acción política: Asistir a manifestaciones autorizadas

data_proc <- data_proc %>% 
  mutate(p55st_b = car::recode(.$p55st_b,
                               recodes = c("1 = 'Lo ha realizado';
                                           2 = 'Lo podria realizar';
                                           3 = 'Nunca lo haria';
                                           -1 = 'NA';
                                           -2 = 'NA';
                                           -3 = 'NA';
                                           -4 = 'NA';
                                           -5 = 'NA'"),
                               as.factor = T,
                               levels = c('Lo ha realizado',
                                          'Lo podria realizar',
                                          'Nunca lo haria')))

#Comprobamos
frq(data_proc$p55st_b)

##Dispuesto a salir a marchar y protestar por: Una sociedad con mas igualdad

#!!!!!!!!!!!!!!!!!!

# No me importaría que un gobierno no democrático llegara al poder si resuelve los problemas

data_proc <- data_proc %>% 
  mutate(p22stm_b = car::recode(.$p22stm_b,
                                recodes = c("1 = 'Muy de acuerdo';
                                            2 = 'De acuerdo';
                                            3 = 'En desacuerdo';
                                            4 = 'Muy en desacuerdo';
                                            -1 = 'NA';
                                            -2 = 'NA';
                                            -3 = 'NA';
                                            -4 = 'NA'"),
                                as.factor = T,
                                levels = c('Muy en desacuerdo',
                                           'En desacuerdo',
                                           'De acuerdo',
                                           'Muy de acuerdo')))

#Comprobemos
frq(data_proc$p22stm_b)

#P20STM.C La democracia permite que se solucionen los problemas que tenemos

data_proc <- data_proc %>% 
  mutate(p20stm_c = car::recode(.$p20stm_c,
                                recodes = c("1 = 'Muy de acuerdo';
                                            2 = 'De acuerdo';
                                            3 = 'En desacuerdo';
                                            4 = 'Muy en desacuerdo';
                                            -1 = 'NA';
                                            -2 = 'NA';
                                            -3 = 'NA';
                                            -4 = 'NA'"),
                                as.factor = T,
                                levels = c('Muy en desacuerdo',
                                           'En desacuerdo',
                                           'De acuerdo',
                                           'Muy de acuerdo')))

#Comprobemos
frq(data)
frq(data_proc$p20stm_c)

#Satisfacción con la democracia

data_proc <- data_proc %>% 
  mutate(satisfaccion_demo = car::recode(.$satisfaccion_demo,
                                         recodes = c("1 = 'Muy satisfecho';
                                                     2 = 'Satisfecho';
                                                     3 = 'No muy satisfecho';
                                                     4 = 'Nada satisfecho';
                                                     -1 = 'No sabe';
                                                     -2 = 'NA';
                                                     -3 = 'NA';
                                                     -4 = 'NA';
                                                     -5 = 'NA'"),
                                         as.factor = T,
                                         levels = c('Nada satisfecho',
                                                    'No muy satisfecho',
                                                    'Satisfecho',
                                                    'Muy satisfecho',
                                                    'No sabe')))

#Comprobemos
frq(data$P11STGBS_A)
frq(data_proc$satisfaccion_demo)

# Pais
data_proc <- data_proc %>% 
  mutate(pais = car::recode(.$pais,
                            recodes = c("32 = 'Argentina';
                                        68 = 'Bolivia';
                                        76 = 'Brasil';
                                        152 = 'Chile';
                                        170 = 'Colombia';
                                        188 = 'Costa Rica';
                                        214 = 'Rep. Dominicana';
                                        218 = 'Ecuador';
                                        222 = 'El Salvador';
                                        320 = 'Guatemala';
                                        340 = 'Honduras';
                                        484 = 'Mexico';
                                        558 = 'Nicaragua';
                                        591 = 'Panama';
                                        600 = 'Paraguay';
                                        604 = 'Peru';
                                        724 = 'NA';
                                        858 = 'Uruguay';
                                        862 = 'Venezuela';
                                        -1 = 'NA';
                                        -2 = 'NA';
                                        -3 = 'NA';
                                        -4 = 'NA';
                                        -5 = 'NA'"),
                            as.factor = T,
                            levels = c('Argentina',
                                       'Bolivia',
                                       'Brasil',
                                       'Chile',
                                       'Colombia',
                                       'Costa Rica',
                                       'Rep. Dominicana',
                                       'Ecuador',
                                       'El Salvador',
                                       'Guatemala',
                                       'Honduras',
                                       'Mexico',
                                       'Nicaragua',
                                       'Panama',
                                       'Paraguay',
                                       'Peru',
                                       'Uruguay',
                                       'Venezuela')))

#comprobamos
frq(data$idenpa)
frq(data_proc$pais)

#Sexo
data_proc <- data_proc %>% 
  mutate(sexo = car::recode(.$sexo,
                            recodes = c("1 = 'Hombre';
                                        2 = 'Mujer'"),
                            as.factor = T))

#comprobamos
frq(data$sexo)
frq(data_proc$sexo)

#edad

data_proc <- data_proc %>% 
  mutate(edad = car::recode(.$edad,
                            recodes = c("-1 = 'NA';
                                        -2 = 'NA';
                                        -3 = 'NA';
                                        -4 = 'NA';
                                        -5 = 'NA'"),
                            as.numeric = T))

#Comprobemos
frq(data$edad) #Edad estaba originalmente como variable de tipo caracter
descr(data_proc$edad)

# 6. Agregar etiquetas a variables:--------------------------

data_proc$nc_partidos <- set_label(data_proc$nc_partidos, 'Confianza en los Partidos Politicos')
data_proc$p62st_b <- set_label(data_proc$p62st_b, 'Las elecciones ofrecen a los votantes una real opcion de elegir entre partidos y candidatos')
data_proc$p56n <- set_label(data_proc$p55st_b, 'La mejor forma de actuar para que Ud. y el pais avancen mas')
data_proc$p55st_b <- set_label(data_proc$p55st_b, 'Accion politica: Asistir a manifestaciones autorizadas')
data_proc$p59n_f <- set_label(data_proc$p59n_f) # falta esta
data_proc$p22stm_b <- set_label(data_proc$p22stm_b, 'No me importaria que un gobierno no democratico llegara al poder si resuelve los problemas')
data_proc$p20stm_c <- set_label(data_proc$p20stm_c, 'La democracia permite que se solucionen los problemas que tenemos')
data_proc$satisfaccion_demo <- set_label(data_proc$satisfaccion_demo, 'Satisfaccion con la democracia')
data_proc$pais <- set_label(data_proc$pais, 'Pais')
data_proc$edad <- set_label(data_proc$edad, 'Edad')
data_proc$sexo <- set_label(data_proc$sexo, 'Sexo')

#revisemos libro de codigos de la base recortada
view_df(data_proc,
        encoding = "UTF-8")

